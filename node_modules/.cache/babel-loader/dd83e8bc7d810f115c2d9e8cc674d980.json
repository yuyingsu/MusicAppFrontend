{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\yuyin\\\\onedrive\\\\desktop\\\\MusicappFrontendDeployment\\\\src\\\\Hoc.js\";\nimport React from 'react';\nimport { logout } from './actions/userActions';\nimport { connect } from 'react-redux';\nimport { Redirect } from \"react-router-dom\";\nimport jwt_decode from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function (ComposedClass) {\n  class Component extends React.Component {\n    constructor(props) {\n      super(props);\n\n      this.setTimeout = () => {\n        console.log(this.state.signoutTime);\n\n        if (this.state.warningTime > 0) {\n          this.warnTimeout = setTimeout(this.warn, this.state.warningTime);\n        }\n\n        if (this.state.signoutTime > 0) {\n          this.logoutTimeout = setTimeout(this.logout, this.state.signoutTime);\n        } else {\n          this.logout();\n        }\n      };\n\n      this.warn = () => {\n        if (this.props.userInfo) {\n          alert('Session Timeout. Your session is about to expire in 1 minute');\n        }\n      };\n\n      this.logout = () => {\n        console.log(this.props.userInfo);\n\n        if (this.props.userInfo) {\n          this.props.logout();\n\n          /*#__PURE__*/\n          _jsxDEV(Redirect, {\n            to: \"/signin\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 49,\n            columnNumber: 13\n          }, this);\n        }\n      };\n\n      let time = Number.POSITIVE_INFINITY;\n\n      if (this.props.userInfo) {\n        let decodedToken = jwt_decode(this.props.userInfo.access_token);\n        let currentDate = new Date();\n        time = decodedToken.exp * 1000 - currentDate.getTime();\n      }\n\n      this.state = {\n        warningTime: time - 1000 * 60,\n        signoutTime: time\n      };\n    }\n\n    componentDidMount() {\n      this.setTimeout();\n    }\n\n    render() {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ComposedClass, { ...this.props\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 57,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 11\n      }, this);\n    }\n\n  }\n\n  return connect(mapStateToProps, mapDispatchToProps)(Component);\n}\n\nconst mapStateToProps = state => {\n  return {\n    userInfo: state.userSignin.userInfo\n  };\n};\n\nconst mapDispatchToProps = dispatch => {\n  return {\n    logout: () => dispatch(logout())\n  };\n};","map":{"version":3,"sources":["C:/Users/yuyin/onedrive/desktop/MusicappFrontendDeployment/src/Hoc.js"],"names":["React","logout","connect","Redirect","jwt_decode","ComposedClass","Component","constructor","props","setTimeout","console","log","state","signoutTime","warningTime","warnTimeout","warn","logoutTimeout","userInfo","alert","time","Number","POSITIVE_INFINITY","decodedToken","access_token","currentDate","Date","exp","getTime","componentDidMount","render","mapStateToProps","mapDispatchToProps","userSignin","dispatch"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,MAAT,QAAuB,uBAAvB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,QAAT,QAAyB,kBAAzB;AACA,OAAOC,UAAP,MAAuB,YAAvB;;AAEA,eAAe,UAASC,aAAT,EAAuB;AAClC,QAAMC,SAAN,SAAwBN,KAAK,CAACM,SAA9B,CAAwC;AACtCC,IAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,YAAMA,KAAN;;AADiB,WAkBnBC,UAlBmB,GAkBN,MAAM;AACjBC,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKC,KAAL,CAAWC,WAAvB;;AACA,YAAG,KAAKD,KAAL,CAAWE,WAAX,GAAuB,CAA1B,EAA4B;AAC1B,eAAKC,WAAL,GAAmBN,UAAU,CAAC,KAAKO,IAAN,EAAY,KAAKJ,KAAL,CAAWE,WAAvB,CAA7B;AACD;;AACD,YAAG,KAAKF,KAAL,CAAWC,WAAX,GAAuB,CAA1B,EAA4B;AAC1B,eAAKI,aAAL,GAAqBR,UAAU,CAAC,KAAKR,MAAN,EAAc,KAAKW,KAAL,CAAWC,WAAzB,CAA/B;AACD,SAFD,MAEK;AACH,eAAKZ,MAAL;AACD;AACF,OA5BkB;;AAAA,WA8BnBe,IA9BmB,GA8BZ,MAAM;AACX,YAAG,KAAKR,KAAL,CAAWU,QAAd,EAAuB;AACnBC,UAAAA,KAAK,CAAC,8DAAD,CAAL;AACH;AACF,OAlCkB;;AAAA,WAoCnBlB,MApCmB,GAoCV,MAAM;AACXS,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAKH,KAAL,CAAWU,QAAvB;;AACA,YAAG,KAAKV,KAAL,CAAWU,QAAd,EAAuB;AACrB,eAAKV,KAAL,CAAWP,MAAX;;AACA;AAAA,kBAAC,QAAD;AAAU,YAAA,EAAE,EAAC;AAAb;AAAA;AAAA;AAAA;AAAA;AACD;AACJ,OA1CkB;;AAEjB,UAAImB,IAAI,GAAGC,MAAM,CAACC,iBAAlB;;AACA,UAAG,KAAKd,KAAL,CAAWU,QAAd,EAAuB;AACrB,YAAIK,YAAY,GAAGnB,UAAU,CAAC,KAAKI,KAAL,CAAWU,QAAX,CAAoBM,YAArB,CAA7B;AACA,YAAIC,WAAW,GAAG,IAAIC,IAAJ,EAAlB;AACAN,QAAAA,IAAI,GAAGG,YAAY,CAACI,GAAb,GAAmB,IAAnB,GAA0BF,WAAW,CAACG,OAAZ,EAAjC;AACD;;AACD,WAAKhB,KAAL,GAAa;AACXE,QAAAA,WAAW,EAAEM,IAAI,GAAC,OAAK,EADZ;AAEXP,QAAAA,WAAW,EAAEO;AAFF,OAAb;AAID;;AAEDS,IAAAA,iBAAiB,GAAG;AAClB,WAAKpB,UAAL;AACD;;AA4BDqB,IAAAA,MAAM,GAAG;AAEP,0BACE;AAAA,+BACE,QAAC,aAAD,OAAmB,KAAKtB;AAAxB;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,cADF;AAMD;;AArDqC;;AAuDxC,SAAON,OAAO,CAAC6B,eAAD,EAAkBC,kBAAlB,CAAP,CAA6C1B,SAA7C,CAAP;AACH;;AAGD,MAAMyB,eAAe,GAAGnB,KAAK,IAAI;AAC7B,SAAO;AACHM,IAAAA,QAAQ,EAAEN,KAAK,CAACqB,UAAN,CAAiBf;AADxB,GAAP;AAGH,CAJD;;AAMA,MAAMc,kBAAkB,GAAGE,QAAQ,IAAI;AACnC,SAAO;AACHjC,IAAAA,MAAM,EAAE,MAAMiC,QAAQ,CAACjC,MAAM,EAAP;AADnB,GAAP;AAGH,CAJD","sourcesContent":["import React from 'react';\nimport { logout } from './actions/userActions';\nimport { connect } from 'react-redux';\nimport { Redirect } from \"react-router-dom\";\nimport jwt_decode from 'jwt-decode';\n\nexport default function(ComposedClass){\n    class Component extends React.Component {\n      constructor(props) {\n        super(props);\n        let time = Number.POSITIVE_INFINITY;\n        if(this.props.userInfo){\n          let decodedToken = jwt_decode(this.props.userInfo.access_token);\n          let currentDate = new Date();\n          time = decodedToken.exp * 1000 - currentDate.getTime();\n        }\n        this.state = {\n          warningTime: time-1000*60,\n          signoutTime: time\n        };\n      }\n\n      componentDidMount() {\n        this.setTimeout();\n      }\n\n      setTimeout = () => {\n        console.log(this.state.signoutTime)\n        if(this.state.warningTime>0){\n          this.warnTimeout = setTimeout(this.warn, this.state.warningTime);\n        }\n        if(this.state.signoutTime>0){\n          this.logoutTimeout = setTimeout(this.logout, this.state.signoutTime);\n        }else{\n          this.logout();\n        }\n      };\n\n      warn = () => {\n        if(this.props.userInfo){\n            alert('Session Timeout. Your session is about to expire in 1 minute');\n        }\n      };\n\n      logout = () => {\n          console.log(this.props.userInfo);\n          if(this.props.userInfo){\n            this.props.logout();\n            <Redirect to='/signin' />\n          }\n      };\n\n      render() {\n\n        return (\n          <div>\n            <ComposedClass {...this.props} />\n          </div>\n        );\n\n      }\n    }\n    return connect(mapStateToProps, mapDispatchToProps)(Component)\n}\n\n\nconst mapStateToProps = state => {\n    return {\n        userInfo: state.userSignin.userInfo\n    }\n};\n\nconst mapDispatchToProps = dispatch => {\n    return {\n        logout: () => dispatch(logout())\n    }\n};"]},"metadata":{},"sourceType":"module"}